% system_cn.tex  ——  STM32+OpenCM 扩展板系统框图（全中文）
\documentclass[tikz,border=5pt]{standalone}
\usepackage{tikz}
\usepackage{ctex}
\usetikzlibrary{shapes,arrows.meta,positioning,backgrounds}

% 颜色定义
\definecolor{power}{HTML}{f8cecc}
\definecolor{dcdc}{HTML}{dae8fc}
\definecolor{mcu}{HTML}{d5e8d4}
\definecolor{peri}{HTML}{fff2cc}
\definecolor{bus}{HTML}{e1d5e7}
\begin{document}

\begin{tikzpicture}[
    node distance = 1.6cm and 1.3cm,
    block/.style  = {draw, rounded corners, minimum width=2.4cm, minimum height=1cm, align=center, thick},
    power/.style  = {block, fill=power},
    dcdc/.style   = {block, fill=dcdc},
    mcu/.style    = {block, fill=mcu},
    peri/.style   = {block, fill=peri},
    bus/.style    = {block, fill=bus, rounded rectangle},
    -{Stealth[length=3mm]}, line width=0.6pt
]

% 电源链
\node[power] (batt) {7.4\,V 锂电池\\2S 5000\,mAh};
\node[dcdc, right=of batt] (dc) {5\,V 4\,A 降压模块\\MP2307};
\node[dcdc, right=of dc] (ldo) {3.3\,V 线性稳压\\AMS1117};

% MCU
\node[mcu, below=of dc] (mcu) {STM32F407VGT6\\主控 168\,MHz};

% 外设
\node[peri, below left=of mcu] (wifi) {ESP8266-12F\\无线 Wi-Fi};
\node[peri, below=of mcu] (cam) {OV2640 摄像头\\200 万像素};
\node[peri, below right=of mcu] (tof) {VL53L0X\\激光测距传感器};
\node[peri, right=of tof] (oled) {0.96 英寸 OLED\\128×64 显示屏};

% 总线 + 舵机
\node[bus, below=of cam] (ttl) {TTL 半双工总线\\Dynamixel 协议};
\node[power, below=of ttl] (servo) {LDX-218 数字舵机\\9 个 40\,kg·cm};

% 电源连线
\draw (batt) -- (dc);
\draw (dc)  -- (ldo);
\draw (ldo) -- (mcu);

% 外设连线（避开穿框）
\draw (mcu) -- (wifi);
\draw (mcu.south) -- (cam.north);   % 仅改这里：south → north 正中
\draw (mcu) -- (tof);
\draw (mcu) -- (oled);
\draw (cam.south) -- (ttl.north);   % 摄像头→TTL 也走正中
\draw (ttl.south) -- (servo.north);

\end{tikzpicture}
\end{document}